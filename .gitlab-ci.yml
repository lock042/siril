macos-deps:
  stage: build
  tags:
    - shared-macos-amd64
  image: macos-11-xcode-12 # https://docs.gitlab.com/ee/ci/runners/build_cloud/macos/environment.html
  before_script:
    - cd build/macOS/
  script:
    - ./010-install_python.sh 1>/dev/null
    - ./020-install_SDK.sh 1>/dev/null
    - ./100-setup_jhbuild.sh 1>/dev/null
    - ./110-setup_gtk_mac_bundler.sh 1>/dev/null
    - ./120-bootstrap.sh
  cache:
    key: setup-system
    paths:
      - ~/.new_local
      - ~/gtk
      - ~/.config

macos-siril:
  stage: deployed
  tags:
    - shared-macos-amd64
  image: macos-11-xcode-12 # https://docs.gitlab.com/ee/ci/runners/build_cloud/macos/environment.html
  before_script:
    - source ~/.profile && jhbuild build $(jhbuild info siril|grep '^Requires:'|sed -e 's|^Requires:||' -e 's|gegl||'|tr -d ',')
    - find  ~/gtk/source -type d -mindepth 1 -maxdepth 1 | xargs -I% rm -rf %/*
  script:
    - jhbuild build siril
  cache:
    key: setup-system
    paths:
      - ~/.new_local
      - ~/gtk
      - ~/.config
