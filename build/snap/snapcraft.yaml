name: siril
adopt-info: siril

grade: stable
confinement: strict
base: core22
compression: lzo

apps:
  siril:
    command: usr/bin/siril
    extensions: [gnome-3-38]
    environment:
      GTK_USE_PORTAL: 0
      DISABLE_WAYLAND: 1
    plugs:
      - home
      - removable-media
      - password-manager-service
      - network
      - network-bind
      - network-status
  cli:
    command: usr/bin/siril-cli
    extensions: [gnome-3-38]
    environment:
      GTK_USE_PORTAL: 0
      DISABLE_WAYLAND: 1
    plugs:
      - home
      - removable-media
      - password-manager-service
      - network
      - network-bind
      - network-status

version: '1.3.6'
summary: Astronomical image processing software
description: |
  Siril is an astronomical image processing tool, able to convert, pre-process 
  and process deep-sky images, stacked sequences of images and SER files.
  It features registration tools, stacking methods, many filters and file 
  formats support.

architectures:
  - build-on: amd64
  - build-on: arm64

parts:
  siril:
    plugin: meson
    source-type: git
    source: https://gitlab.com/free-astro/siril.git
    meson-parameters:
      - --prefix=/usr
      - --buildtype=release
    stage-packages:
      - libgtk-3-0
      - libcfitsio9
      - libfftw3-3
      - libgsl27
      - libraw20
      - libexiv2-27
      - libopencv-core4.5
      - libopencv-imgproc4.5
      - libheif1
      - libxisf0
      - libgit2-1.1
      - libjxl0.7
      - wcslib7
    build-packages:
      - build-essential
      - pkg-config
      - cmake
      - ninja-build
      - libgtk-3-dev
      - libcfitsio-dev
      - libfftw3-dev
      - libgsl-dev
      - libraw-dev
      - libexiv2-dev
      - libopencv-dev
      - libheif-dev
      - libgit2-dev
      - libssl-dev
#      - libjxl-dev
      - wcslib-dev
      - intltool
      - gettext
     
  libxisf:
    plugin: cmake
    source-type: git
    source: https://gitea.nouspiro.space/nou/libXISF.git
    cmake-parameters:
      - -DCMAKE_INSTALL_PREFIX=/usr
      - -DUSE_BUNDLED_ZLIB=OFF
    build-packages:
      - build-essential
      - libpugixml-dev
      - libzstd-dev

layout:
  /usr/share/siril:
    bind: $SNAP/usr/share/siril
  /usr/lib/$SNAPCRAFT_ARCH_TRIPLET/siril:
    bind: $SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/siril
